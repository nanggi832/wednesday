<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iloom 3D Artwork Cost</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Pretendard', -apple-system, sans-serif;
    background: #ccc8c0;
    min-height: 100vh;
    padding: 52px 40px;
    overflow-y: scroll;
  }
  .container { max-width: 1000px; margin: 0 auto; }
  h1 { font-size: 26px; font-weight: 700; margin-bottom: 3px; letter-spacing: -0.5px; color: #1a1a1a; }
  .subtitle { font-size: 12px; color: #999; margin-bottom: 22px; }

  /* â”€â”€ ë¦¬ì…‹ ë²„íŠ¼ â”€â”€ */
  .title-bar { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 22px; }
  .title-bar .titles h1 { margin-bottom: 3px; }
  .title-bar .subtitle { margin-bottom: 0; }
  .reset-btn {
    display: flex; align-items: center; gap: 6px;
    padding: 8px 16px; border-radius: 10px;
    border: 1.5px solid #d8d2c8; background: #fff;
    font-family: inherit; font-size: 12px; font-weight: 600;
    color: #a89888; cursor: pointer;
    transition: all .15s;
    box-shadow: 0 1px 6px rgba(0,0,0,0.07);
  }
  .reset-btn:hover { border-color: #c86858; color: #c86858; background: #fff5f3; }
  .reset-btn svg { width: 13px; height: 13px; flex-shrink: 0; }

  .table-outer { border-radius: 14px; box-shadow: 0 2px 24px rgba(0,0,0,0.13); }
  .table-wrap { background: #fff; border-radius: 14px; overflow: visible; }
  .row.hd { border-radius: 14px 14px 0 0; }
  .row.add { border-radius: 0 0 14px 14px; }

  .row {
    display: grid;
    grid-template-columns: 220px 100px 235px 175px 140px 130px;
    align-items: center;
    border-bottom: 1px solid #eeebe5;
    min-height: 45px;
  }
  .row:last-child { border-bottom: none; }
  .row:hover:not(.hd):not(.total):not(.sec-main):not(.add) { background: #faf8f4; }
  .row.on { background: #f7f3ed; }

  .row.hd { background: #f5f2ec; min-height: 38px; border-bottom: 1px solid #e8e4dc; }
  .row.hd .c { font-size: 11px; color: #aaa49c; font-weight: 500; justify-content: center; }
  .row.hd .c.hd-name { justify-content: flex-start; padding-left: 76px; }
  .row.hd .c.hd-price { justify-content: flex-end; padding-right: 80px; }

  .row.sec-main { background: #e8e2d8; min-height: 22px; border-bottom: 1px solid #d8d0c4; cursor: default; }
  .row.sec-main:hover { background: #e8e2d8 !important; }
  .row.sec-main .c { font-size: 11px; font-weight: 700; color: #7a6a58; letter-spacing: 0.3px; padding-left: 16px; justify-content: flex-start; grid-column: 1/-1; }

  .row.total { background: #1a1714; min-height: 58px; border-bottom: none; border-radius: 0 0 14px 14px; }
  .row.add { min-height: 40px; cursor: pointer; border-bottom: none; }
  .row.add:hover { background: #f5f2ec; }
  .row.add .c { font-size: 12px; color: #bbb5ac; padding-left: 18px; justify-content: flex-start; }

  .row > .c:nth-child(1) { padding-left: 16px; }
  .row > .c:nth-child(5) { padding-right: 50px; justify-content: flex-end; }
  .row > .c:nth-child(6) { padding-right: 30px; justify-content: flex-end; }
  .c { padding: 0 16px; display: flex; align-items: center; }
  .c.mid { justify-content: center; }
  .c.rt { justify-content: flex-end; }

  input[type=checkbox] { display: none; }
  .chk {
    width: 17px; height: 17px; border-radius: 4px; border: 1.5px solid #cdc8c0;
    background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: all .15s; flex-shrink: 0;
  }
  .chk:hover { border-color: #9a8a78; }
  input[type=checkbox]:checked + .chk { background: #7a6a58; border-color: #7a6a58; }
  input[type=checkbox]:checked + .chk::after {
    content: ''; width: 9px; height: 5px;
    border-left: 2px solid #fff; border-bottom: 2px solid #fff;
    transform: rotate(-45deg) translateY(-1px); display: block;
  }

  .iname { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 500; color: #2a2520; white-space: nowrap; overflow: hidden; }
  .ico { font-size: 14px; flex-shrink: 0; }
  .iname.sub { padding-left: 10px; color: #6a5e52; font-size: 12px; }
  .iname.sub::before { content: 'â””'; color: #c0b8ae; font-size: 11px; flex-shrink: 0; }

  .abtn { background: none; border: none; font-family: inherit; cursor: pointer; font-size: 14px; color: #c8c2b8; line-height: 1; padding: 0 2px; flex-shrink: 0; transition: color .12s; }
  .abtn:hover { color: #7a6a58; }
  .abtn.rm:hover { color: #c86858; }

  .lvs { display: flex; gap: 2px; }
  .lv { padding: 2px 5px; border-radius: 4px; border: 1.5px solid #ddd8d0; background: #fff; font-size: 10px; font-weight: 600; color: #c0b8ae; cursor: pointer; font-family: inherit; transition: all .12s; line-height: 1.5; }
  .lv:hover { border-color: #a89880; color: #7a6a58; }
  .lv.on { background: #7a5c3a; border-color: #7a5c3a; color: #fff; }

  .sqs { display: flex; gap: 4px; }
  .sq { width: 17px; height: 17px; border-radius: 3px; background: #ede9e3; transition: background .2s; }
  .sq.on { background: #7a6a58; }

  .wks { display: flex; gap: 5px; }
  .wk { padding: 3px 7px; border-radius: 5px; background: #ede9e3; font-size: 10px; font-weight: 600; color: #b8b0a4; transition: background .2s, color .2s; }
  .wk.on { background: #7a6a58; color: #fff; }

  .dd-wrap { position: relative; width: 158px; user-select: none; }
  .dd-btn { width: 158px; height: 32px; border: 1.5px solid #d8d2c8; border-radius: 9px; padding: 0 28px 0 12px; font-size: 12px; font-weight: 500; font-family: inherit; color: #a89888; background: #fff; cursor: pointer; display: flex; align-items: center; transition: border-color .15s; position: relative; }
  .dd-btn::after { content: ''; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-left: 4px solid transparent; border-right: 4px solid transparent; border-top: 5px solid #b0a090; transition: transform .2s; }
  .dd-btn.ok { color: #3a2e22; border-color: #a89070; font-weight: 600; }
  .dd-btn.open { border-color: #9a8870; border-radius: 9px 9px 0 0; }
  .dd-btn.open::after { transform: translateY(-50%) rotate(180deg); }
  .dd-list { display: none; position: absolute; top: 100%; left: 0; width: 158px; background: #fff; border: 1.5px solid #9a8870; border-top: none; border-radius: 0 0 9px 9px; overflow: hidden; z-index: 999; box-shadow: 0 6px 18px rgba(0,0,0,0.10); }
  .dd-list.open { display: block; }
  .dd-item { padding: 8px 12px; font-size: 12px; font-weight: 500; font-family: inherit; color: #6a5e52; cursor: pointer; border-bottom: 1px solid #eeebe5; transition: background .1s; }
  .dd-item:last-child { border-bottom: none; }
  .dd-item:hover { background: #f7f3ed; }
  .dd-item.selected { color: #3a2e22; font-weight: 700; background: #f2eeea; }

  .ctr { display: flex; align-items: center; gap: 7px; width: 158px; }
  .cbtn { width: 28px; height: 28px; border-radius: 7px; border: 1.5px solid #d8d2c8; background: #fff; cursor: pointer; font-size: 13px; font-family: inherit; color: #a89888; display: flex; align-items: center; justify-content: center; transition: all .12s; flex-shrink: 0; }
  .cbtn:hover { border-color: #9a8870; color: #7a6a58; }
  .ctag { flex: 1; padding: 5px 0; border-radius: 7px; font-size: 12px; font-weight: 600; background: #eee8e0; color: #8a7868; text-align: center; }

  .price { font-size: 13px; color: #4a3e32; font-feature-settings: "tnum"; }
  .ref-price { font-size: 11px; color: #c0b4a4; font-feature-settings: "tnum"; }
  .row.total .c { justify-content: center; }
  .tot-lbl { font-size: 14px; color: #fff; font-weight: 700; }
  .tot-val { font-size: 15px; color: #c0a888; font-weight: 700; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
<div class="container">
  <div class="title-bar">
    <div class="titles">
      <h1>iloom 3D Artwork Cost</h1>
      <p class="subtitle">ì œí’ˆ 1ì¢… ê¸°ì¤€</p>
    </div>
    <div style="display:flex;gap:8px">
    <button class="reset-btn" onclick="captureScreen()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="12" cy="12" r="4"/>
      </svg>
      í™”ë©´ìº¡ì³
    </button>
    <button class="reset-btn" onclick="resetAll()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
        <path d="M3 3v5h5"/>
      </svg>
      ì´ˆê¸°í™”
    </button>
    </div>
  </div>
  <div class="table-outer">
    <div class="table-wrap">

      <div class="row hd">
        <div class="c hd-name">í•­ëª©</div>
        <div class="c mid">ë‚œì´ë„</div>
        <div class="c mid">ê¸°ê°„</div>
        <div class="c mid">ìˆ˜ëŸ‰</div>
        <div class="c mid"></div>
        <div class="c hd-price">ë‹¨ê°€</div>
      </div>

      <div class="row sec-main"><div class="c">ğŸ›‹ï¸ ì œí’ˆ 3D ëª¨ë¸ë§</div></div>
      <div id="mRows"></div>

      <div class="row sec-main"><div class="c">ğŸ–¼ï¸ ì œí’ˆ ë Œë”</div></div>
      <div id="renderRows"></div>

      <div class="row sec-main"><div class="c">ğŸ” ë””í…Œì¼ ì»·</div></div>
      <div id="detailRows"></div>

      <div class="row sec-main"><div class="c">â­ ìŠ¤íƒ€ì¼ ì»·</div></div>
      <div id="styleRows"></div>

      <div class="row sec-main"><div class="c">ğŸ¬ ì• ë‹ˆë©”ì´ì…˜</div></div>
      <div id="aniRows"></div>

      <div class="row total" id="totRow"></div>
    </div>
  </div>
</div>

<script>
const MTYPES = [
  {label:'ëª¨ë¸ë§ ìœ í˜•',           days:0, price:0,      lv:null},
  {label:'(ìƒ) ì†ŒíŒŒ',             days:9, price:500000, lv:0},
  {label:'(ìƒ) ë°ìŠ¤í¬ì²´ì–´',       days:9, price:500000, lv:0},
  {label:'(ìƒ) ì±…ìƒì„¸íŠ¸',         days:9, price:500000, lv:0},
  {label:'(ì¤‘) ì‹íƒ',             days:6, price:250000, lv:1},
  {label:'(ì¤‘) ì‹íƒì˜ì',         days:6, price:250000, lv:1},
  {label:'(ì¤‘) ì¹¨ëŒ€í”„ë ˆì„',       days:6, price:250000, lv:1},
  {label:'(í•˜) ì†ŒíŒŒ ëª¨ë“ˆ',        days:3, price:100000, lv:2},
  {label:'(í•˜) ë¶€í’ˆ ë° ì•…ì„¸ì‚¬ë¦¬', days:3, price:100000, lv:2},
];

// ì œí’ˆ 3D ëª¨ë¸ë§ ìƒì¤‘í•˜ ê¸°ê°„/ê°€ê²©
const MLV = [
  {days:4, price:500000},  // ìƒ
  {days:3, price:250000},  // ì¤‘
  {days:2, price:100000},  // í•˜
];
const LVS = ['ìƒ','ì¤‘','í•˜'];

const DEF_RENDER = [
  {id:101, name:'ì œí’ˆ ë‹¨í’ˆì»·', ico:'ğŸª‘', cut:0, price:150000, days:2, lv:null, def:true, noLv:true},
  {id:102, name:'ë§ˆê°ì¬ ì¶”ê°€', ico:'ğŸ¨', cut:0, price:150000, days:1, lv:null, def:true, noLv:true},
  {id:103, name:'ì•µê¸€ ì¶”ê°€',   ico:'ğŸ”„', cut:0, price: 50000, days:1, lv:null, def:true, noLv:true},
  {id:104, name:'ë‹¨í’ˆ ì—°ì¶œì»·', ico:'ğŸ¨', cut:0, price:150000, days:2, lv:null, def:true, noLv:true},
];
const DEF_DETAIL = [
  {id:201, name:'ë””í…Œì¼ì»·',    ico:'ğŸ”', cut:0, price:0, days:0, lv:null, def:true,
   lvData:[{days:3,price:300000},{days:2,price:200000},{days:1,price:100000}]},
  {id:203, name:'ë§ˆê°ì¬ êµì²´', ico:'ğŸ”', cut:0, price: 50000, days:1, lv:null, def:true, noLv:true},
];
const DEF_STYLE = [
  {id:301, name:'ë©”ì¸ì»·',                ico:'ğŸ ', cut:0, price:0, days:0, lv:null, def:true, lvData:[{days:7,price:700000},{days:5,price:500000},{days:3,price:300000}]},
  {id:304, name:'ë©”ì¸ì»· (ì•µê¸€/ë¼ì´íŒ…)',  ico:'ğŸŒƒ', cut:0, price:150000, days:2, lv:null, def:true, noLv:true},
  {id:305, name:'ë©”ì¸ì»· (ë¼ì´í”„ìŠ¤íƒ€ì¼)',ico:'ğŸ±', cut:0, price:100000, days:2, lv:null, def:true, noLv:true},
];
const DEF_ANI = [
  {id:401, name:'ì•„ì´ì½”ë‹‰ ì˜ìƒ',   ico:'ğŸ¬', cut:0, price:0, days:0, lv:null, def:true, isWeek:true, lvData:[{days:5,price:7000000},{days:4,price:6000000},{days:3,price:5000000}]},
  {id:404, name:'ê³µê°„ë¬´ë“œ ì˜ìƒ',   ico:'ğŸ“½ï¸', cut:0, price:0, days:0, lv:null, def:true, isWeek:true, lvData:[{days:5,price:5000000},{days:4,price:4000000},{days:3,price:3000000}]},
  {id:405, name:'ê¸°ì¡´ ì»· í¸ì§‘',    ico:'âœ‚ï¸', cut:0, price: 300000, days:1, lv:null, def:true, isWeek:true, noLv:true},
  {id:406, name:'USP ë””í…Œì¼ í´ë¦½', ico:'ğŸ“²', cut:0, price: 800000, days:2, lv:null, def:true, isWeek:true, noLv:true},
];

function freshM(){ return [{id:1,ti:0,checked:false,lv:null},{id:'mx',name:'ëª¨ë¸ë§ ë³€í˜•',ico:'ğŸ“',cut:0,price:100000,days:2,lv:null,checked:false,isMx:true}]; }

function load(){try{const s=localStorage.getItem('iloom_v79');if(s)return JSON.parse(s);}catch(e){}return null;}
function save(){try{localStorage.setItem('iloom_v79',JSON.stringify({M,R,D,S,A,mc,ic}));}catch(e){}}

const sv=load();
let M  = sv?sv.M : freshM();
let R  = sv?sv.R : DEF_RENDER.map(f=>({...f,checked:false}));
let D  = sv?sv.D : DEF_DETAIL.map(f=>({...f,checked:false}));
let S  = sv?sv.S : DEF_STYLE.map(f=>({...f,checked:false}));
let A  = sv?sv.A : DEF_ANI.map(f=>({...f,checked:false}));
let mc = sv?sv.mc: 2;
let ic = sv?sv.ic: 500;

const fmt = n => n.toLocaleString('ko-KR')+'ì›';
const fmtRef = n => n.toLocaleString('ko-KR');
const sqs = n => Array.from({length:10},(_,i)=>`<div class="sq${i<n?' on':''}"></div>`).join('');
const wks = n => Array.from({length:5}, (_,i)=>`<div class="wk${i<n?' on':''}">Week</div>`).join('');

function captureScreen(){
  const el = document.querySelector('.table-outer');
  html2canvas(el, {scale:2, backgroundColor:'#fff', useCORS:true}).then(canvas=>{
    const a=document.createElement('a');
    a.download='iloom_cost_'+new Date().toISOString().slice(0,10)+'.png';
    a.href=canvas.toDataURL('image/png');
    a.click();
  });
}
function resetAll(){
  if(!confirm('ëª¨ë“  í•­ëª©ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  M=freshM();
  R=DEF_RENDER.map(f=>({...f,checked:false}));
  D=DEF_DETAIL.map(f=>({...f,checked:false}));
  S=DEF_STYLE.map(f=>({...f,checked:false}));
  A=DEF_ANI.map(f=>({...f,checked:false}));
  mc=2; ic=500;
  makeHandlers(R,'R'); makeHandlers(D,'D'); makeHandlers(S,'S'); makeHandlers(A,'A');
  render();
}

document.addEventListener('click', e=>{ if(!e.target.closest('.dd-wrap')) closeAllDd(); });
function closeAllDd(){
  document.querySelectorAll('.dd-list.open').forEach(el=>el.classList.remove('open'));
  document.querySelectorAll('.dd-btn.open').forEach(el=>el.classList.remove('open'));
}
function toggleDd(id){ const btn=document.getElementById('ddb-'+id),lst=document.getElementById('ddl-'+id); if(!btn||!lst)return; const was=lst.classList.contains('open'); closeAllDd(); if(!was){btn.classList.add('open');lst.classList.add('open');} }
function selectDd(mId,ti){ 
  const m=M.find(x=>x.id===mId); 
  if(m){
    m.ti=ti;
    const mt=MTYPES[ti];
    if(mt.lv!==null){ m.lv=mt.lv; m.days=MLV[mt.lv].days; }
    else { m.lv=null; m.days=0; }
  } 
  closeAllDd(); render(); 
}
function makeDd(m){
  const t=MTYPES[m.ti], ok=m.ti>0;
  return `<div class="dd-wrap"><div class="dd-btn${ok?' ok':''}" id="ddb-${m.id}" onclick="toggleDd(${m.id});event.stopPropagation()">${t.label}</div><div class="dd-list" id="ddl-${m.id}">${MTYPES.map((o,i)=>`<div class="dd-item${m.ti===i?' selected':''}" onclick="selectDd(${m.id},${i})">${o.label}</div>`).join('')}</div></div>`;
}

function renderM(){
  const w=document.getElementById('mRows'); w.innerHTML='';
  M.forEach((m,idx)=>{
    const row=document.createElement('div');
    row.className='row'+(m.checked?' on':'');
    if(m.isMx){
      row.innerHTML=`
        <div class="c"><div class="iname"><button class="abtn" onclick="cloneMx()">ï¼‹</button><span class="ico">${m.ico}</span>${m.name}</div></div>
        <div class="c mid"></div>
        <div class="c mid"><div class="sqs">${sqs(m.cut*2)}</div></div>
        <div class="c mid"><div class="ctr"><button class="cbtn" onclick="cutMx(-1)">ï¼</button><span class="ctag">${m.cut}ê°œ</span><button class="cbtn" onclick="cutMx(1)">ï¼‹</button></div></div>
        <div class="c mid"><span class="ref-price">${fmtRef(m.price||100000)}</span></div>
        <div class="c rt">${m.cut>0?`<span class="price">${fmt(m.cut*(m.price||100000))}</span>`:''}</div>`;
    } else {
      const t=MTYPES[m.ti];
      const mlv = m.lv!==null ? MLV[m.lv] : null;
      const lvBtns=LVS.map((l,li)=>`<button class="lv${m.lv===li?' on':''}" onclick="lvM(${m.id},${li})">${l}</button>`).join('');
      row.innerHTML=`
        <div class="c"><div class="iname">${idx===0?`<button class="abtn" onclick="addM()">ï¼‹</button>`:`<button class="abtn rm" onclick="delM(${m.id})">ï¼</button>`}<span class="ico">ğŸ“¦</span>ì œí’ˆ 3D ëª¨ë¸ë§</div></div>
        <div class="c mid"><div class="lvs">${lvBtns}</div></div>
        <div class="c mid"><div class="sqs">${sqs(m.days||0)}</div></div>
        <div class="c mid">${makeDd(m)}</div>
        <div class="c mid"><span class="ref-price">Â±${fmtRef(MLV[1].price)}</span></div>
        <div class="c rt">${mlv?`<span class="price">${fmt(mlv.price)}</span>`:''}</div>`;
    }
    w.appendChild(row);
  });
}

function renderSection(arr, elId, setFns){
  const w=document.getElementById(elId); w.innerHTML='';
  arr.forEach(item=>{
    const row=document.createElement('div');
    row.className='row'+(item.checked?' on':'');
    const lvBtns=item.noLv?'':`<div class="lvs">${LVS.map((l,li)=>`<button class="lv${item.lv===li?' on':''}" onclick="${setFns.lv}(${item.id},${li})">${l}</button>`).join('')}</div>`;
    const btn=item.def?`<button class="abtn" onclick="${setFns.clone}(${item.id})">ï¼‹</button>`:`<button class="abtn rm" onclick="${setFns.del}(${item.id})">ï¼</button>`;
    row.innerHTML=`
      <div class="c"><div class="iname">${btn}<span class="ico">${item.ico}</span>${item.name}</div></div>
      <div class="c mid">${lvBtns}</div>
      <div class="c mid"><div class="${item.isWeek?'wks':'sqs'}">${item.isWeek?wks(item.cut*item.days):sqs(item.cut*item.days)}</div></div>
      <div class="c mid"><div class="ctr"><button class="cbtn" onclick="${setFns.cut}(${item.id},-1)">ï¼</button><span class="ctag">${item.cut}ì»·</span><button class="cbtn" onclick="${setFns.cut}(${item.id},1)">ï¼‹</button></div></div>
      <div class="c mid">${(()=>{
        if(item.noLv && item.price>0) return `<span class="ref-price">${fmtRef(item.price)}</span>`;
        if(item.lvData && item.lvData[1]) return `<span class="ref-price">Â±${fmtRef(item.lvData[1].price)}</span>`;
        if(!item.noLv && item.price>0) return `<span class="ref-price">Â±${fmtRef(item.price)}</span>`;
        return '';
      })()}</div>
      <div class="c rt">${item.cut>0&&item.price>0?`<span class="price">${fmt(item.cut*item.price)}</span>`:''}</div>`;
    w.appendChild(row);
  });
}

function renderTot(){
  const r=document.getElementById('totRow'); let tc=0,tp=0;
  [...R,...D,...S,...A].forEach(i=>{if(i.cut>0){tc+=i.cut;tp+=i.cut*i.price;}});
  M.forEach(m=>{
    if(m.isMx){if(m.cut>0){tc+=m.cut;tp+=m.cut*(m.price||100000);}}
    else{const mlv=m.lv!==null?MLV[m.lv]:null; if(mlv){tp+=mlv.price;}}
  });
  r.innerHTML=`<div class="c" style="justify-content:center"><span class="tot-lbl">í•©ê³„</span></div><div class="c"></div><div class="c"></div><div class="c" style="justify-content:center"><span class="tot-val">${tc}ì»·</span></div><div class="c"></div><div class="c rt" style="white-space:nowrap;padding-right:30px"><span class="tot-val">${fmt(tp)}</span></div>`;
}

function render(){ renderM(); renderSection(R,'renderRows',{lv:'lvR',clone:'cloneR',del:'delR',chk:'chkR',cut:'cutR'}); renderSection(D,'detailRows',{lv:'lvD',clone:'cloneD',del:'delD',chk:'chkD',cut:'cutD'}); renderSection(S,'styleRows',{lv:'lvS',clone:'cloneS',del:'delS',chk:'chkS',cut:'cutS'}); renderSection(A,'aniRows',{lv:'lvA',clone:'cloneA',del:'delA',chk:'chkA',cut:'cutA'}); renderTot(); save(); }

function addM(){M.splice(M.length-1,0,{id:mc++,ti:0,checked:false,lv:null});render();}
function delM(id){M=M.filter(m=>m.id!==id);render();}
function chkM(id,v){const m=M.find(m=>m.id===id);if(m){m.checked=v;render();}}
function lvM(id,lv){lv=parseInt(lv);const m=M.find(m=>m.id===id);if(m){m.lv=m.lv===lv?null:lv; if(m.lv!==null&&MLV[m.lv])m.days=MLV[m.lv].days; else m.days=0; render();}}
function chkMx(v){const m=M.find(m=>m.isMx);if(m){m.checked=v;if(v&&m.cut===0)m.cut=1;if(!v)m.cut=0;render();}}
function cutMx(d){const m=M.find(m=>m.isMx);if(m){m.cut=Math.max(0,m.cut+d);render();}}
function cloneMx(){const m=M.find(m=>m.isMx);if(m){m.cut=Math.max(1,m.cut+1);if(!m.checked)m.checked=true;render();}}

function showToast(msg){
  let t=document.getElementById('toast');
  if(!t){t=document.createElement('div');t.id='toast';t.style.cssText='position:fixed;bottom:32px;left:50%;transform:translateX(-50%);background:#3a2e22;color:#fff;padding:10px 22px;border-radius:10px;font-size:13px;font-weight:600;opacity:0;transition:opacity .2s;z-index:9999;pointer-events:none;';document.body.appendChild(t);}
  t.textContent=msg; t.style.opacity='1';
  clearTimeout(t._t); t._t=setTimeout(()=>t.style.opacity='0',1800);
}

function makeHandlers(arr, prefix){
  window[`lv${prefix}`] = (id,lv)=>{
    id=parseInt(id); lv=parseInt(lv);
    const i=arr.find(x=>x.id===id); if(!i) return;
    i.lv = i.lv===lv ? null : lv;
    if(i.lv!==null && i.lvData&&i.lvData[i.lv]){i.price=i.lvData[i.lv].price; i.days=i.lvData[i.lv].days;}
    else if(i.lv===null){i.days=0; if(i.lvData)i.price=0;}
    render();
  };
  window[`chk${prefix}`] = (id,v)=>{id=parseInt(id);const i=arr.find(x=>x.id===id);if(i){i.checked=v;if(v&&i.cut===0)i.cut=1;if(!v)i.cut=0;render();}};
  window[`cut${prefix}`] = (id,d)=>{
    id=parseInt(id);
    const i=arr.find(x=>x.id===id); if(!i) return;
    if(d>0 && !i.noLv && i.lv===null){ showToast('ë‚œì´ë„ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”'); return; }
    i.cut=Math.max(0,i.cut+d); render();
  };
  window[`del${prefix}`]   = (id)  =>{id=parseInt(id);arr.splice(arr.findIndex(x=>x.id===id),1);render();};
  window[`clone${prefix}`] = (sid) =>{sid=parseInt(sid);const src=arr.find(x=>x.id===sid);if(!src)return;const idx=arr.findIndex(x=>x.id===sid);arr.splice(idx+1,0,{...src,id:ic++,def:false});render();};
}
makeHandlers(R,'R'); makeHandlers(D,'D'); makeHandlers(S,'S'); makeHandlers(A,'A');
render();
</script>
</body>
</html>
